# Manual Exploitation Development For TVT NVMS 1000 suffers from a directory traversal tag vulnerability

## What is a directory traversal exploit?
The directory traversal/path traversal attack (also known as dot dot slash attack) is an HTTP
exploit that allows an attacker to access restricted files, directories and commands that reside
outside the web server’s root directory. Directory traversal attacks are executed through web
browsers. An attacker may manipulate a URL in such way that the website will reveal the
confined files on the web server.

This type of exploit owes its name to the fact that the attacker uses special-character
“../”sequence to escape web document root, or alternate encodings of the “../” sequence to
bypass security filters and access files or directories that reside outside the root directory.
The attackers can modify critical files such as programs or libraries, download password files,
expose source code of the web application, or execute powerful commands on the web server,
which can lead to complete compromise of the web server.

Consider a shopping application that displays images of items for sale. Images are loaded via
some HTML like the following:
```
<img src="/loadImage?filename=218.png">
```

The **loadImage** URL takes a **filename** parameter and returns the contents of the specified
file. The image files themselves are stored on disk in the location /var/www/images/. To
return an image, the application appends the requested filename to this base directory and uses
a filesystem API to read the contents of the file. In the above case, the application reads from
the following file path:
```
/var/www/images/218.png
```

The application implements no defenses against directory traversal attacks, so an attacker can
request the following URL to retrieve an arbitrary file from the server's filesystem:
```
https://insecure-website.com/loadImage?filename=../../../etc/passwd
```

This causes the application to read from the following file path
```
/var/www/images/../../../etc/passwd
```

The sequence ../ is valid within a file path, and means to step up one level in the directory
structure. The three consecutive ../ sequences step up from */var/www/images/* to the
filesystem root, and so the file that is actually read is:
```
/etc/passwd
```

On Unix-based operating systems, this is a standard file containing details of the users that are
registered on the server.

On Windows, both ../ and ..\ are valid directory traversal sequences, and an equivalent attack to
retrieve a standard operating system file would be:
```
https://insecure-website.com/loadImage?filename=..\..\..\windows\win.ini
```

## Common obstacles to exploiting file path traversal vulnerabilities
Many applications that place user input into file paths implement some kind of defense against
path traversal attacks, and these can often be circumvented.

If an application strips or blocks directory traversal sequences from the user-supplied filename,
then it might be possible to bypass the defense using a variety of techniques.

You might be able to use an absolute path from the filesystem root, such
as filename=/etc/passwd, to directly reference a file without using any traversal sequences.

## Example of vulnerable application
Here the sample PHP code:
<br>
![Capture1](https://user-images.githubusercontent.com/41334869/81847256-3209c700-9508-11ea-9a02-a83c07ad25bc.PNG)

</br>
An attack against this system could be to send the following HTTP request:
<br>
![Capture 2](https://user-images.githubusercontent.com/41334869/81847574-a3497a00-9508-11ea-80dc-772fbcc38e13.PNG)

</br>

Generating a server response such as:
<br>
![Capture 3](https://user-images.githubusercontent.com/41334869/81847753-e1469e00-9508-11ea-8d8b-9495e19eb352.PNG)

</br>

## Prevent a directory traversal attack
The most effective way to prevent file path traversal vulnerabilities is to avoid passing usersupplied input to filesystem APIs altogether. Many application functions that do this can be
rewritten to deliver the same behavior in a safer way.

If it is considered unavoidable to pass user-supplied input to filesystem APIs, then two layers of
defense should be used together to prevent attacks.
* The application should validate the user input before processing it. Ideally, the validation
should compare against a whitelist of permitted values. If that isn't possible for the required
functionality, then the validation should verify that the input contains only permitted
content, such as purely alphanumeric characters.
* After validating the supplied input, the application should append the input to the base
directory and use a platform filesystem API to canonicalize the path. It should verify that the
canonicalized path starts with the expected base directory.

Below is an example of some simple Java code to validate the canonical path of a file based on user
input:
<br>
![Capture 4](https://user-images.githubusercontent.com/41334869/81847871-15ba5a00-9509-11ea-9694-47aca99fdae5.PNG)
</br>

### 1. Preparation
We need following requirements,
  * Network configuration- NAT (Virtual machine settings)
  * NVMS 1000- Directory Traversal exploit - https://www.exploit-db.com/exploits/47774
  * Victim’s end - https://www.hackthebox.eu/home/machines/profile/240
  
### 2. NVMS 1000 - Directory traversal Vulnerability 
![NVMS 1000 – Directory traversal Exploit](/img/5.JPG)
NVMS 1000 – Directory traversal Exploit
<br>
![Capture 5](https://user-images.githubusercontent.com/41334869/81848043-5c0fb900-9509-11ea-9a30-9f7e559cfb5f.PNG)
</br>

### 3. Walkthrough
* Victim’s machine.
<br>
![victim's machine](https://user-images.githubusercontent.com/41334869/81848167-8a8d9400-9509-11ea-84ae-fac628756540.PNG)
</br>

* Using “ping” command check whether machine “IP ‘’ available or no
![Ping](https://user-images.githubusercontent.com/41334869/81848248-abee8000-9509-11ea-8746-bb5a86219e12.PNG)

* With the” Nmap” scan, gather the information of the victim’s machine
![nmap](https://user-images.githubusercontent.com/41334869/81848313-c32d6d80-9509-11ea-8bfb-e68e593ed961.PNG)
After nmap scan, we can identify available ports in there.

* Check the port 80 in there
![nvms loggine](https://user-images.githubusercontent.com/41334869/81848429-f7089300-9509-11ea-91c3-b947e8414d0c.PNG)

When we check the port 80, we can see the logging page of the NVMS-1000(web portal).

* Check the port 22 in there
![ftp](https://user-images.githubusercontent.com/41334869/81848549-23bcaa80-950a-11ea-8de6-de6fb98fd729.PNG)

* There are have hidden text file
![ftp1](https://user-images.githubusercontent.com/41334869/81848636-44850000-950a-11ea-9fab-07f547556786.PNG)
Hidden text was telling about the password file location.
![hidden text](https://user-images.githubusercontent.com/41334869/81848719-654d5580-950a-11ea-93a4-3be1908da43d.PNG)


* Check whether is there any vulnerability in NVMS-1000 vulnerability.
![available](https://user-images.githubusercontent.com/41334869/81848794-83b35100-950a-11ea-9f37-98266a229625.PNG)
There has vulnerability for NVMS 1000 and, there have Directory traversal exploit for that.
* Through the burp suit, try to attack NVMS-1000 web portal and
Intercept the network traffic through the burp.
![burp 1](https://user-images.githubusercontent.com/41334869/81848948-ae9da500-950a-11ea-84fe-d03050748114.PNG)


* Change the http request as a founded exploit.
![burb2](https://user-images.githubusercontent.com/41334869/81849069-da208f80-950a-11ea-9ba8-217434530e08.PNG)

Wait for the response.
![burp 3](https://user-images.githubusercontent.com/41334869/81849122-ed335f80-950a-11ea-935e-a3194ef82e6d.PNG)

Exploit is working

* There have 2 user account, Nathan and Nadine.
![user account](https://user-images.githubusercontent.com/41334869/81849211-13f19600-950b-11ea-84ec-7ed295109b9f.PNG)

![hidden text](https://user-images.githubusercontent.com/41334869/81849426-5b782200-950b-11ea-9624-a90683f2a69e.PNG)

There have hint for password file actually located, in here Password file located in desktop of Nathan
user. There for we can predict the password file location. (/user/Nathan/Desktop/Password.txt)
![http requst](https://user-images.githubusercontent.com/41334869/81849504-7480d300-950b-11ea-86a1-d8e161e27cfb.PNG)


After that change the exploit with the updated password file path and send the http request after
that Password list given with the response. exploit was successful.

* Port 22 is open therefore we can ssh to the server ,we have user name and password .
simply we can get access to the server.

## References 
[1] https://vuldb.com/?id.147865.
[2] https://www.bitdefender.com/consumer/support/answer/10557/
[3] https://portswigger.net/web-security/file-path-traversal
[4] https://en.wikipedia.org/wiki/Directory_traversal_attack
[5] https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-20085
[6] https://www.exploit-db.com/exploits/47774


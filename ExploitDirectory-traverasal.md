#Manual Exploitation Development TVT NVMS 1000 suffers from a directory traversal vulnerability

What is a directory traversal exploit?
The directory traversal/path traversal attack (also known as dot dot slash attack) is an HTTP exploit that allows an attacker to access restricted files, directories and commands that reside outside the web server's root directory. Directory traversal attacks are executed through web browsers. An attacker may manipulate a URL in such way that the website will reveal the confined files on the web server.

This type of exploit owes its name to the fact that the attacker uses special-character "../"sequence to escape web document root, or alternate encodings of the "../" sequence to bypass security filters and access files or directories that reside outside the root directory.

The attackers can modify critical files such as programs or libraries, download password files, expose source code of the web application, or execute powerful commands on the web server, which can lead to complete compromise of the web server.

Consider a shopping application that displays images of items for sale. Images are loaded via some HTML like the following:

&lt;img src="/loadImage?filename=218.png"&gt;

The loadImage URL takes a filename parameter and returns the contents of the specified file. The image files themselves are stored on disk in thelocation /var/www/images/. To return an image, the application appends therequested filename to this base directory and uses a filesystem API to read the contents of the file. In the above case, the application reads from the following file path:

/var/www/images/218.png

The application implements no defenses against directory traversal attacks, so an attacker can request the following URL to retrieve an arbitrary file from the server's filesystem:

https://insecure-website.com/loadImage?filename=../../../etc/passwd

This causes the application to read from the following file path:

/var/www/images/../../../etc/passwd

The sequence ../ is valid within a file path, and means to step up one level in the directory structure. The three consecutive ../ sequences step up from /var/www/images/ to the filesystem root, and so the file that is actually read is:

/etc/passwd

On Unix-based operating systems, this is a standard file containing details of the users that are registered on the server.

On Windows, both ../ and ..\ are valid directory traversal sequences, and an equivalent attack to retrieve a standard operating system file would be:

https://insecure-website.com/loadImage?filename=......\windows\win.ini

LAB File path traversal, simple case

Common obstacles to exploiting file path traversal vulnerabilities
Many applications that place user input into file paths implement some kind of defense against path traversal attacks, and these can often be circumvented.

If an application strips or blocks directory traversal sequences from the user-supplied filename, then it might be possible to bypass the defense using a variety of techniques.

You might be able to use an absolute path from the filesystem root, such as filename=/etc/passwd, to directly reference a file without using any traversal sequences.

Example of vulnerable application

Here the sample PHP code



An attack against this system could be to send the following HTTP request:



Generating a server response such as:



Prevent a directory traversal attack
The most effective way to prevent file path traversal vulnerabilities is to avoid passing user-supplied input to filesystem APIs altogether. Many application functions that do this can be rewritten to deliver the same behavior in a safer way.

If it is considered unavoidable to pass user-supplied input to filesystem APIs, then two layers of defense should be used together to prevent attacks.

The application should validate the user input before processing it. Ideally, the validation should compare against a whitelist of permitted values. If that isn't possible for the required functionality, then the validation should verify that the input contains only permitted content, such as purely alphanumeric characters.
After validating the supplied input, the application should append the input to the base directory and use a platform filesystem API to canonicalize the path. It should verify that the canonicalized path starts with the expected base directory.
Below is an example of some simple Java code to validate the canonical path of a file based on user input:



Preparation
Kali Linux - attacker/exploit development (VM Ware)
we need following requirements,

Network configuration- NAT (Virtual machine settings)
NVMS 1000- Directory Traversal exploit - https://www.exploit-db.com/exploits/47774
Victim's end - https://www.hackthebox.eu/home/machines/profile/240
NVMS 1000 - Directory traversal Vulnerability
CVE-2019-20085	Vector - CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
Base Score: 7.5 HIGH	
CWE-22	
TVT NVMS-1000 devices allow GET /.. Directory Traversal	
NVMS 1000 â€“ Directory traversal Exploit


Walkthrough
Victim's machine.
V 

Using "ping" command check whether machine "IP '' available or not.


With the" Nmap" scan, gather the information of the victim's machine


After nmap scan, we can identify available ports in there.

Check the port 80 in there


When we check the port 80, we can see the logging page of the NVMS-1000(web portal).

Check the port 22 in there


There are have hidden text file


Hidden text was telling about the password file location.



Check whether is there any vulnerability in NVMS-1000 vulnerability.


There has vulnerability for NVMS 1000 and, there have Directory traversal exploit for that.

Through the burp suit, try to attack NVMS-1000 web portal and
Intercept the network traffic through the burp.



Change the http request as a founded exploit.


Wait for the response.



Exploit is working

There have 2 user account, Nathan and Nadine.




There have hint for password file actually located, in here Password file located in desktop of Nathan user. There for we can predict the password file location. (/user/Nathan/Desktop/Password.txt)



After that change the exploit with the updated password file path and send the http request after that Password list given with the response. exploit was successful.

Port 22 is open therefore we can ssh to the server ,we have user name and password . simply we can get access to the server.
Finding the offset value
_ Adding payload _

Browse the Register and Stack panes
Find an instruction
References
[1] https://jtnydv.gitbook.io/wiki/exploitation-practice/freefloat-ftp-server-1.0#final-payload-development

[2] https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/

[3] http://www.securitysift.com/windows-exploit-development-part-2-intro-stack-overflow/

[4] http://z.cliffe.schreuders.org

[5] http://resources.infosecinstitute.com/in-depth-seh-exploit-writing-tutorial-using-ollydbg/

[6] http://www.exploit-db.com/exploits/17540/

[7] https://blog.own.sh/introduction-to-network-protocol-fuzzing-buffer-overflow-exploitation/

1 | Page

Want to convert another document?
